$(function () {
    var inputFile = $('input[name=userfile]');
    var uploadURI = $('#form-upload').attr('action');
    var progressBar = $('#progress-bar');

    //listFilesOnServer();

    $('#upload-btn').on('click', function (event) {
        //myJsMain.commonFunction.showPleaseWait();
        if (inputFile.val() != "") {
            var fileToUpload = inputFile[0].files[0];
            // make sure there is file to upload
            if (fileToUpload != 'undefined') {
                extainstionArr = inputFile.val().split(".");
                console.log(extainstionArr.length);
                extainstion = extainstionArr[extainstionArr.length - 1];
                if (extainstion == 'xlsx' || extainstion == 'xls') {
                    // provide the form data
                    // that would be sent to sever through ajax
                    var formData = new FormData();
                    formData.append("userfile", fileToUpload);
                    myJsMain.commonFunction.showPleaseWait();
                    // now upload the file using $.ajax
                    $.ajax({
                        url: uploadURI,
                        type: 'post',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (data) {
                            //listFilesOnServer();
                            showuploadedImage(data);
                        },
                        /*xhr: function() {
                         var xhr = new XMLHttpRequest();
                         xhr.upload.addEventListener("progress", function(event) {
                         if (event.lengthComputable) {
                         var percentComplete = Math.round( (event.loaded / event.total) * 100 );
                         // console.log(percentComplete);
                         
                         $('.progress').show();
                         progressBar.css({width: percentComplete + "%"});
                         progressBar.text(percentComplete + '%');
                         };
                         }, false);
                         
                         return xhr;
                         }*/
                    });
                } else {
                    EliminaTipo2("Please select vallid excel file for mark bulk upload", "error");
                }
            } else {
                EliminaTipo2("Please select excel file for mark bulk upload", "error");
            }
        } else {
            EliminaTipo2("Please select excel file for mark bulk upload", "error");
        }
    });

    function showuploadedImage(data) {
        //debugger;
        console.log(data); 
        //debugger;
        myJsMain.commonFunction.hidePleaseWait();
        if (data == 0) {//debugger;
            EliminaTipo2("Mark Uploaded Successfully", "success");
        } else if (data == 1) {//debugger;
            EliminaTipo2("Please select excel file for mark bulk upload", "error");
        } else if (data == 2) {//debugger;
            EliminaTipo2("Please select vallid excel file for mark bulk upload", "error");
        } else if (data == 3) {//debugger;
            EliminaTipo2("Opps... please upload validata data for upload the mark bulk upload.", "error");debugger;
            setTimeout(function(){
                location.href = siteBaseUrl + 'index.php?school_admin/mark_display_bulk_upload_errors';
              }, 1500);
            
        }else if(data == 4){
            location.href=siteBaseUrl;
        }
        //debugger;
    }

    /*$('body').on('click', '.remove-file', function () {
     var me = $(this);
     
     $.ajax({
     url: uploadURI,
     type: 'post',
     data: {file_to_remove: me.attr('data-file')},
     success: function() {
     me.closest('li').remove();
     }
     });
     
     });
     /*
     
     
     /*$('body').on('change.bs.fileinput', function(e) {
     $('.progress').hide();
     progressBar.text("0%");
     progressBar.css({width: "0%"});
     });*/
});